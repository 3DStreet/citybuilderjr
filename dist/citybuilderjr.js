!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(self,(()=>(()=>{var t={631:t=>{var e=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];function i(t,i,s,n){const o=1/n,r=1/s;return e[0].set(o*i,r*t+r),e[1].set(o*i,r*t),e[2].set(o*i+o,r*t),e[3].set(o*i+o,r*t+r),e}AFRAME.registerComponent("atlas-uvs",{dependencies:["geometry"],schema:{totalColumns:{type:"int",default:1},totalRows:{type:"int",default:1},column:{type:"int",default:1},row:{type:"int",default:1}},update:function(){const t=this.data,e=i(t.row-1,t.column-1,t.totalRows,t.totalColumns),s=this.el.getObject3D("mesh").geometry;var n=new Float32Array([e[0].x,e[0].y,e[3].x,e[3].y,e[1].x,e[1].y,e[2].x,e[2].y]);s.setAttribute("uv",new THREE.BufferAttribute(n,2)),s.uvsNeedUpdate=!0}}),AFRAME.registerComponent("dynamic-texture-atlas",{schema:{canvasId:{default:"dynamicAtlas"},canvasHeight:{default:1024},canvasWidth:{default:1024},debug:{default:!1},numColumns:{default:8},numRows:{default:8}},multiple:!0,init:function(){const t=this.canvas=document.createElement("canvas");t.id=this.data.canvasId,t.height=this.data.canvasHeight,t.width=this.data.canvasWidth,this.ctx=t.getContext("2d"),document.body.appendChild(t),this.data.debug&&(t.style.left=0,t.style.top=0,t.style.position="fixed",t.style.zIndex=9999999999)},drawTexture:function(t,e,s,n,o){const r=this.canvas,a=this.data;t.complete||(t.onload=()=>{this.drawTexture(t,e,s)});const l=o||r.height/a.numRows,d=n||r.width/a.numColumns;return this.ctx.drawImage(t,d*e,d*s,d,l),i(e,s,a.numRows,a.numColumns)}}),t.exports.getGridUvs=i},1:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("gridhelper",{schema:{size:{default:5},divisions:{default:10},colorCenterLine:{default:"red"},colorGrid:{default:"black"}},init:function(){var t=this.el.object3D,e=this.data,i=e.size,s=e.divisions,n=e.colorCenterLine,o=e.colorGrid,r=new THREE.GridHelper(i,s,n,o);r.name="gridHelper",t.add(r)},remove:function(){var t=this.el.object3D;t.remove(t.getObjectByName("gridHelper"))}})},174:()=>{var t,e=AFRAME.utils.debug,i=AFRAME.utils.coordinates,s=e("components:look-at:warn"),n=i.isCoordinates||i.isCoordinate;delete AFRAME.components["look-at"],AFRAME.registerComponent("look-at",{schema:{default:"0 0 0",parse:function(t){return n(t)||"object"==typeof t?i.parse(t):t},stringify:function(t){return"object"==typeof t?i.stringify(t):t}},init:function(){this.target3D=null,this.vector=new THREE.Vector3,this.cameraListener=AFRAME.utils.bind(this.cameraListener,this),this.el.addEventListener("componentinitialized",this.cameraListener),this.el.addEventListener("componentremoved",this.cameraListener)},update:function(){var t,e=this,i=e.data;return!i||"object"==typeof i&&!Object.keys(i).length?e.remove():"object"==typeof i?this.lookAt(new THREE.Vector3(i.x,i.y,i.z)):(t=e.el.sceneEl.querySelector(i))?t.hasLoaded?e.beginTracking(t):t.addEventListener("loaded",(function(){e.beginTracking(t)})):void s('"'+i+'" does not point to a valid entity to look-at')},tick:(t=new THREE.Vector3,function(e){var i=this.target3D;i&&(i.getWorldPosition(t),this.lookAt(t))}),remove:function(){this.el.removeEventListener("componentinitialized",this.cameraListener),this.el.removeEventListener("componentremoved",this.cameraListener)},beginTracking:function(t){this.target3D=t.object3D},cameraListener:function(t){t.detail&&"camera"===t.detail.name&&this.update()},lookAt:function(t){var e=this.vector,i=this.el.object3D;this.el.getObject3D("camera")?e.subVectors(i.position,t).add(i.position):e.copy(t),i.lookAt(e)}})},699:()=>{AFRAME.registerComponent("proxy-event",{schema:{captureBubbles:{default:!1},enabled:{default:!0},event:{type:"string"},from:{type:"string"},to:{type:"string"},as:{type:"string"},bubbles:{default:!1}},multiple:!0,init:function(){var t,e,i,s=this.data,n=this.el,o=this;if(s.from?t="PARENT"===s.from?[n.parentNode]:document.querySelectorAll(s.from):i="CHILDREN"===s.to?n.querySelectorAll("*"):"SELF"===s.to?[n]:document.querySelectorAll(s.to),s.from)for(e=0;e<t.length;e++)this.addEventListenerFrom(t[e]);else n.addEventListener(s.event,(function(t){var s=o.data;if(s.enabled&&(s.captureBubbles||t.target===n))for(e=0;e<i.length;e++)i[e].emit(s.as||s.event,t.detail?t.detail:null,s.bubbles)}))},addEventListenerFrom:function(t){var e=this.data,i=this;t.addEventListener(e.event,(function(e){var s=i.data;s.enabled&&(s.captureBubbles||e.target===t)&&i.el.emit(s.as||s.event,e.detail?e.detail:null,!1)}))}})},858:function(t){var e;"undefined"!=typeof self&&self,e=function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";var s={};t.exports.select=function(t,e,i){return s[e]||(s[e]=new Function("state","item","return "+d(e)+";")),s[e](t,i)};var n=/\.([A-Za-z][\w_-]*)/g,o=/([=&|!?:+-])(\s*)([\(]?)([A-Za-z][\w_-]*)/g,r=/^([\(]?)([A-Za-z][\w_-]*)/g,a=/state\["item"\]/g,l=/state\["(true|false)"\]/g;function d(t){return(t=(t=(t=(t=t.replace(n,'["$1"]')).replace(r,'$1state["$2"]')).replace(o,'$1$2$3state["$4"]')).replace(a,"item")).replace(l,"$1")}function c(){var t=arguments;return function(){var e;for(e=0;e<t.length;e++)t[e].apply(this,arguments)}}t.exports.generateExpression=d,t.exports.clearObject=function(t){for(var e in t)delete t[e]},t.exports.composeHandlers=function(){var t,e,i,s=arguments;for(i={},e=0;e<s.length;e++)for(t in s[e])t in i?i[t].constructor===Array?i[t].push(s[e][t]):i[t]=[i[t],s[e][t]]:i[t]=s[e][t];for(t in i)i[t].constructor===Array&&(i[t]=c.apply(this,i[t]));return i},t.exports.composeFunctions=c;var h=["||","&&","!=","!==","==","===",">","<","<=",">="],u=/\s+/,p=/\(|\)|\!/g;function f(t){return-1===(t=function(t){return 0===t.indexOf("!!")?t.replace("!!",""):0===t.indexOf("!")?t.replace("!",""):t}(t.trim())).indexOf(".")?t:t.substring(0,t.indexOf("."))}t.exports.parseKeysToWatch=function(t,e,i){var s,n;for(n=y(e,u),s=0;s<n.length;s++)if(-1===h.indexOf(n[s])&&!n[s].startsWith("'")&&-1===t.indexOf(n[s])){if(i&&"item"===n[s])continue;t.push(f(n[s]).replace(p,""))}return t};var m={};function y(t,e){return m[e]||(m[e]={}),m[e][t]||(m[e][t]=t.split(e)),m[e][t]}t.exports.split=y,t.exports.copyArray=function(t,e){var i;for(t.length=0,i=0;i<e.length;i++)t[i]=e[i]}},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i(2);var n,o,r=i(3),a=i(0),l=i(4).wrapArray,d={initialState:{},nonBindedStateKeys:[],handlers:{},computeState:[function(){}]},c="object";AFRAME.registerState=function(t){var e=d.computeState;t.computeState&&e.push(t.computeState),AFRAME.utils.extendDeep(d,t),d.computeState=e},AFRAME.registerSystem("state",{init:function(){var t,e=this;for(t in this.arrays=[],this.dirtyArrays=[],this.diff={},this.state=AFRAME.utils.clone(d.initialState),this.subscriptions=[],this.initEventHandlers(),this.state)this.state[t]&&this.state[t].constructor===Array&&(this.arrays.push(t),this.state[t].__dirty=!0,l(this.state[t]));this.lastState=AFRAME.utils.clone(this.state),this.eventDetail={lastState:this.lastState,state:this.state},this.el.addEventListener("loaded",(function(){var t;for(t=0;t<d.computeState.length;t++)d.computeState[t](e.state,"@@INIT");for(t=0;t<e.subscriptions.length;t++)e.subscriptions[t].onStateUpdate(e.state)}))},dispatch:(o=[],function(t,e){var i,s;for(d.handlers[t](this.state,e),i=0;i<d.computeState.length;i++)d.computeState[i](this.state,t,e);for(s in this.diff)delete this.diff[s];for(r(this.lastState,this.state,this.diff,d.nonBindedStateKeys),this.dirtyArrays.length=0,i=0;i<this.arrays.length;i++)this.state[this.arrays[i]].__dirty&&this.dirtyArrays.push(this.arrays[i]);var n=0;for(i=0;i<this.subscriptions.length;i++){if("bind-for"===this.subscriptions[i].name){if(!this.state[this.subscriptions[i].keysToWatch[0]].__dirty)continue}else if(!this.shouldUpdate(this.subscriptions[i].keysToWatch,this.diff,this.dirtyArrays))continue;-1===o.indexOf(this.subscriptions[i])&&(o.push(this.subscriptions[i]),n++)}for(s in this.state)this.state[s]&&this.state[s].constructor===Array&&(this.state[s].__dirty=!1);for(this.copyState(this.lastState,this.state),i=0;i<n;i++)o.pop().onStateUpdate();this.eventDetail.action=t,this.eventDetail.payload=e,this.el.emit("stateupdate",this.eventDetail)}),copyState:function(t,e,i){var s;for(s in e)if(i||-1===d.nonBindedStateKeys.indexOf(s))if(e[s]&&e[s].constructor===Object){if(!(s in t)){t[s]=AFRAME.utils.clone(e[s]);continue}this.copyState(t[s],e[s],!0)}else t[s]=e[s]},subscribe:function(t){this.subscriptions.push(t)},unsubscribe:function(t){var e=this.subscriptions.indexOf(t);e>-1&&this.subscriptions.splice(e,1)},shouldUpdate:function(t,e,i){for(var s=0;s<t.length;s++)if(t[s]in e||-1!==i.indexOf(t[s]))return!0;return!1},initEventHandlers:function(){var t,e=[];for(t in i=i.bind(this),d.handlers)-1===e.indexOf(t)&&(e.push(t),i(t));function i(t){var e=this;this.el.addEventListener(t,(function(i){e.dispatch(t,i.detail)}))}},renderTemplate:(n=/{{\s*(\w*\.)?([\w.]+)\s*}}/g,function(t,e,i){var o,r;if(r=t,e)for(;o=n.exec(t);)r=r.replace(o[0],(void 0===e?"undefined":s(e))===c?a.select(e,o[2])||"":e);return i?r:document.createRange().createContextualFragment(r)}),select:a.select}),AFRAME.registerComponent("bind",{schema:{default:{},parse:function(t){var e,i,s,n;if(t.constructor===Object)return t;if(-1===t.indexOf(":"))return t;for(e={},s=a.split(t,";"),i=0;i<s.length;i++)e[(n=a.split(s[i].trim(),":"))[0]]=n[1].trim();return e}},multiple:!0,init:function(){var t;this.data,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system=this.el.sceneEl.systems.state,this.id&&(t=a.split(this.id,"__")[0]),this.isNamespacedBind=this.id&&t in AFRAME.components&&!AFRAME.components[t].isSingleProp||t in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this),this.onStateUpdate=this.onStateUpdate.bind(this)},update:function(){var t,e=this.data;if(this.keysToWatch.length=0,"string"==typeof e)a.parseKeysToWatch(this.keysToWatch,e);else for(t in e)a.parseKeysToWatch(this.keysToWatch,e[t]);this.onStateUpdate()},onStateUpdate:function(){var t,e,i,n,o=!1,r=this.el;if(r.parentNode){if(this.isNamespacedBind&&a.clearObject(this.updateObj),i=this.system.state,s(this.data)!==c){try{n=a.select(i,this.data)}catch(t){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if((void 0===n?"undefined":s(n))!==c&&s(this.lastData)!==c&&this.lastData===n)return;return AFRAME.utils.entity.setComponentProperty(r,this.id,n),void(this.lastData=n)}for(t in this.data){e=this.data[t].trim();try{n=a.select(i,e)}catch(t){throw console.log(t),new Error("[aframe-state-component] Key '"+e+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if((void 0===n?"undefined":s(n))===c||s(this.lastData[t])===c||this.lastData[t]!==n){if(t in AFRAME.components&&void 0===n)return void r.removeAttribute(t);this.isNamespacedBind?this.updateObj[t]=n:AFRAME.utils.entity.setComponentProperty(r,t,n),this.lastData[t]=n}}for(o in this.updateObj);this.isNamespacedBind&&o&&r.setAttribute(this.id,this.updateObj)}},remove:function(){this.system.unsubscribe(this)}}),AFRAME.registerComponent("bind-toggle",{schema:{type:"string"},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system.subscribe(this),this.onStateUpdate()},update:function(){this.keysToWatch.length=0,a.parseKeysToWatch(this.keysToWatch,this.data)},onStateUpdate:function(){var t,e,i=this.el;t=this.system.state;try{e=a.select(t,this.data)}catch(t){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}e?i.setAttribute(this.id,""):i.removeAttribute(this.id)},remove:function(){this.system.unsubscribe(this)}}),t.exports={composeFunctions:a.composeFunctions,composeHandlers:a.composeHandlers,select:a.select}},function(t,e,i){"use strict";var s,n,o=i(0);AFRAME.registerComponent("bind-for",{schema:{delay:{default:0},for:{type:"string",default:"item"},in:{type:"string"},key:{type:"string"},pool:{default:0},template:{type:"string"},updateInPlace:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.state,this.onStateUpdate=this.onStateUpdate.bind(this),this.keysToWatch=[],this.renderedKeys=[],this.system.subscribe(this),this.el.children[0]&&"TEMPLATE"===this.el.children[0].tagName?this.template=this.el.children[0].innerHTML.trim():this.template=document.querySelector(this.data.template).innerHTML.trim();for(var t=0;t<this.data.pool;t++)this.el.appendChild(this.generateFromTemplate(null,t))},update:function(){this.keysToWatch[0]=o.split(this.data.in,".")[0],this.onStateUpdate()},onStateUpdateNaive:(n=[],function(){var t,e=this.data,i=this.el;try{t=o.select(this.system.state,e.in)}catch(t){throw new Error("[aframe-state-component] Key '"+e.in+"' not found in state. #"+i.getAttribute("id")+"["+this.attrName+"]")}n.length=0;for(var s=0;s<t.length;s++){var r=t[s];n.push(e.key?r[e.key].toString():r.toString())}for(var a=this.getElsToRemove(n,this.renderedKeys),l=0;l<a.length;l++)a[l].parentNode.removeChild(a[l]);t.length&&this.renderItems(t,n,0)}),renderItems:function(t,e,i){var s,n=this,o=this.data,r=this.el,a=t[i],l=o.key?a[o.key].toString():a.toString();if(-1===this.renderedKeys.indexOf(l))s=this.generateFromTemplate(a,i),r.appendChild(s),this.renderedKeys.push(l);else{if(t.length&&t[0].constructor===String){var d=o.key?a[o.key].toString():a.toString();(s=r.querySelector('[data-bind-for-value="'+d+'"]')).setAttribute("data-bind-for-key",i)}else{var c=this.getBindForKey(a,i);s=r.querySelector('[data-bind-for-key="'+c+'"]')}s.emit("bindforupdate",a,!1)}t[i+1]&&(this.data.delay?setTimeout((function(){n.renderItems(t,e,i+1)}),this.data.delay):this.renderItems(t,e,i+1))},onStateUpdateInPlace:function(){var t=[];return function(){var e,i,s=this.data,n=this.el;try{e=o.select(this.system.state,s.in)}catch(t){throw console.log(t),new Error("[aframe-state-component] Key '"+s.in+"' not found in state. #"+n.getAttribute("id")+"["+this.attrName+"]")}t.length=0;for(var r=0;r<e.length;r++){var a=e[r];i=s.key?a[s.key].toString():a.toString(),t.push(i)}for(var l=this.getElsToRemove(t,this.renderedKeys),d=0;d<l.length;d++)l[d].object3D.visible=!1,l[d].setAttribute("data-bind-for-active","false"),l[d].removeAttribute("data-bind-for-key"),l[d].removeAttribute("data-bind-for-value"),l[d].emit("bindfordeactivate",null,!1),l[d].pause();e.length&&this.renderItemsInPlace(e,t,0)}}(),renderItemsInPlace:function(t,e,i){var s,n=this,o=this.data,r=this.el,a=t[i],l=this.getBindForKey(a,i),d=o.key?a[o.key].toString():a.toString();if(-1===this.renderedKeys.indexOf(d)){if(r.querySelector(':scope > [data-bind-for-active="false"]'))(s=r.querySelector('[data-bind-for-active="false"]')).setAttribute("data-bind-for-key",l),s.setAttribute("data-bind-for-value",d),s.object3D.visible=!0,s.play(),s.setAttribute("data-bind-for-active","true"),s.emit("bindforupdateinplace",a,!1);else{var c=this.generateFromTemplate(a,i);c.addEventListener("loaded",(function(){c.emit("bindforupdateinplace",a,!1)})),r.appendChild(c)}this.renderedKeys.push(d)}else-1!==e.indexOf(d)&&(t.length&&t[0].constructor===String?(s=r.querySelector('[data-bind-for-value="'+d+'"]')).setAttribute("data-bind-for-key",i):s=r.querySelector('[data-bind-for-key="'+l+'"]'),s.emit("bindforupdateinplace",a,!1));t[i+1]&&(this.data.delay?setTimeout((function(){n.renderItemsInPlace(t,e,i+1)}),this.data.delay):this.renderItemsInPlace(t,e,i+1))},generateFromTemplate:function(t,e){var i=this.data;this.el.appendChild(this.system.renderTemplate(this.template,t));var s=this.el.children[this.el.children.length-1];if(!t)return s.setAttribute("data-bind-for-key",""),s.setAttribute("data-bind-for-active","false"),s;var n=this.getBindForKey(t,e);return s.setAttribute("data-bind-for-key",n),i.key||s.setAttribute("data-bind-for-value",t),s.setAttribute("data-bind-for-active","true"),s},getElsToRemove:(s=[],function(t,e){var i=this.data,n=this.el;s.length=0;for(var o=0;o<n.children.length;o++)if("TEMPLATE"!==n.children[o].tagName){var r=i.key?n.children[o].getAttribute("data-bind-for-key"):n.children[o].getAttribute("data-bind-for-value");-1===t.indexOf(r)&&-1!==e.indexOf(r)&&(s.push(n.children[o]),e.splice(e.indexOf(r),1))}return s}),getBindForKey:function(t,e){return this.data.key?t[this.data.key].toString():e.toString()},onStateUpdate:function(){this.data.updateInPlace?this.onStateUpdateInPlace():this.onStateUpdateNaive()},remove:function(){this.el.sceneEl.systems.state.unsubscribe(this)}}),AFRAME.registerComponent("bind-item",{schema:{type:"string"},multiple:!0,init:function(){this.itemData=null,this.keysToWatch=[],this.prevValues={};var t=this.rootEl=this.el.closest("[data-bind-for-key]");if(!t)throw new Error("bind-item component must be attached to entity under a bind-for item.");t.addEventListener("bindforupdateinplace",this.updateInPlace.bind(this)),t.addEventListener("bindfordeactivate",this.deactivate.bind(this)),this.el.sceneEl.systems.state.subscribe(this)},update:function(){this.parseSelector()},updateInPlace:function(t){var e=this.propertyMap;if("false"!==this.rootEl.getAttribute("data-bind-for-active"))for(var i in t&&(this.itemData=t.detail),e){var s=this.select(this.itemData,e[i]);s!==this.prevValues[i]&&(AFRAME.utils.entity.setComponentProperty(this.el,i,s),this.prevValues[i]=s)}},onStateUpdate:function(){this.updateInPlace()},select:function(t,e){return o.select(this.el.sceneEl.systems.state.state,e,t)},deactivate:function(){this.prevValues={}},parseSelector:function(){var t=this.propertyMap={};this.keysToWatch.length=0;var e=o.split(this.id,"__")[0];if(!(e in AFRAME.components)||AFRAME.components[e].isSingleProp)t[this.id]=this.data,o.parseKeysToWatch(this.keysToWatch,this.data,!0);else for(var i=o.split(this.data,";"),s=0;s<i.length;s++){var n=o.split(i[s],":");t[this.id+"."+n[0].trim()]=n[1].trim(),o.parseKeysToWatch(this.keysToWatch,n[1].trim(),!0)}},remove:function(){this.el.sceneEl.systems.state.unsubscribe(this)}})},function(t,e,i){"use strict";var s;t.exports=(s=[],function(t,e,i,n){var o,r,a,l,d,c,h;for(d in l=i||{},s.length=0,t)s.push(d);if(!e)return l;for(a in e)-1===s.indexOf(a)&&s.push(a);for(c=0;c<s.length;c++)d=s[c],n&&-1!==n.indexOf(d)||(o=t[d],r=e[d],((h=o&&r&&o.constructor===Object&&r.constructor===Object)&&!AFRAME.utils.deepEqual(o,r)||!h&&o!==r)&&(l[d]=r));return l})},function(t,e,i){"use strict";var s=["push","pop","shift","unshift","splice"];function n(t,e){var i=t[e];t[e]=function(){i.apply(t,arguments),t.__dirty=!0}}t.exports.wrapArray=function(t){var e;if(!t.__wrapped){for(e=0;e<s.length;e++)n(t,s[e]);t.__wrapped=!0}}}])},t.exports=e()},58:()=>{AFRAME.registerComponent("grid-coord",{schema:{gridCoord:{type:"string",default:""},gridSize:{type:"number",default:5},gridDivisions:{type:"number",default:20}},init:function(){const t=this.data,e=this.el;if(!t.gridCoord)return;[this.lon,this.lat]=t.gridCoord.split(",");const i=this.stateToLocalGrid(t.gridSize,t.gridDivisions);e.setAttribute("position",i)},stateToLocalGrid:function(t,e){const i=e/t,s=this.el.getAttribute("snap");let n=s?s.offset:.01;const[o,r]=[this.lon,this.lat].map((t=>{const e=Number(t);return(e+(e>=0?-n:n))/i}));return{x:o,z:-1*r}}})},613:()=>{AFRAME.registerComponent("grid-cursor",{schema:{allowFrom:{default:"*"},cursor:{default:"#cursor"}},init:function(){this.helperVector=new THREE.Vector3,this.cursorEl=document.querySelector(this.data.cursor),this.oldPos=(new THREE.Vector3).copy(this.cursorEl.object3D.position),this.el.addEventListener("raycaster-intersected",(t=>{t.detail.el.matches(this.data.allowFrom)&&(this.raycaster=t.detail.el)})),this.el.addEventListener("raycaster-intersected-cleared",(t=>{t.detail.el.matches(this.data.allowFrom)&&(this.raycaster=null)})),this.tick=AFRAME.utils.throttleTick(this.tick,30,this)},tick:function(){if(!this.raycaster)return void this.cursorEl.setAttribute("visible",!1);let t=this.raycaster.components.raycaster.getIntersection(this.el);if(!t)return void this.cursorEl.setAttribute("visible",!1);this.cursorEl.setAttribute("visible",!0);const e=((t,e,i)=>{const s=this.helperVector;return s.copy(t),s.x=Math.floor(s.x/i)*i+e,s.y=Math.floor(s.y/i)*i+e,s.z=Math.floor(s.z/i)*i+e,s})((t=>{const e=this.helperVector;return e.copy(t),this.el.object3D.worldToLocal(e),e})(t.point),.125,.25),i=(t=>{const e=new THREE.Vector3;return e.copy(t),this.el.object3D.localToWorld(e),e})(e);this.oldPos.equals(e)||(this.cursorEl.object3D.position.copy(i),this.oldPos.copy(e),this.cursorEl.emit("cursormoved"))}})},318:()=>{AFRAME.registerComponent("grid-model",{schema:{model:{type:"string",default:""}},addGltfModel:function(t){const e=this.el,i=e.sceneEl;i.catalogIsloaded?e.setAttribute("gltf-model","./"+i.systems.state.state.model.list[t].dist):i.addEventListener("catalogIsLoaded",(()=>{e.setAttribute("gltf-model","./"+i.systems.state.state.model.list[t].dist)}))},update:function(t){this.addGltfModel(this.data.model)}})},684:()=>{AFRAME.registerComponent("grid-rotation",{schema:{rotation:{type:"number",default:0}},update:function(t){const e=this.data;this.el.setAttribute("rotation",{x:0,y:e.rotation,z:0})}})},216:()=>{AFRAME.registerComponent("intersection-spawn",{schema:{default:"",parse:AFRAME.utils.styleParser.parse},init:function(){const t=this.data,e=this.el;this.helperVector=new THREE.Vector3,e.addEventListener(t.event,(e=>{if(t.objects&&!e.detail.intersectedEl.classList.contains(t.objects))return;const i=e.detail.intersection.object.el,s=((t,e)=>{const i=this.helperVector;return i.copy(t),e.object3D.worldToLocal(i),i})(e.detail.intersection.point,i),n=this.localToStateGrid(s,t.gridSize,t.gridDivisions);AFRAME.scenes[0].emit("addGridObject",{lon:n.x,lat:n.y})}))},localToStateGrid:function(t,e,i){const s=i/e,n=t.x*s,o=t.z*s*-1;return{x:Math.round(n+(n>=0?.5:-.5)),y:Math.round(o+(o>=0?.5:-.5))}}})},490:()=>{AFRAME.registerComponent("set-rotation-from-anchor",{schema:{anchorId:{type:"selector"}},init:function(){this.anchorEl=null,this.data.anchorId?this.anchorEl=document.querySelector(this.data.anchorId):this.anchorEl=document.querySelector("[anchored]")},tick:function(){this.anchorEl&&this.anchorEl.object3D&&this.el.object3D.quaternion.copy(this.anchorEl.object3D.quaternion)}})},133:()=>{AFRAME.registerComponent("snap",{dependencies:["position"],schema:{offset:{type:"number"},snap:{type:"number"},localId:{type:"selector"}},init:function(){var t=this;this.helperVector=new THREE.Vector3,this.originalPos=this.el.getAttribute("position"),this.el.addEventListener("componentchanged",(function(e){"position"===e.detail.name&&t.update()})),this.localEl=null,this.data.anchorId&&(this.localEl=document.querySelector(this.data.localId))},update:function(){this.data;const t=(t,e,i)=>{const s=this.helperVector;return s.copy(t),s.x=Math.floor(s.x/i)*i+e,s.y=Math.floor(s.y/i)*i+e,s.z=Math.floor(s.z/i)*i+e,s},e=t=>{const e=this.helperVector;return e.copy(t),this.el.object3D.worldToLocal(e),e},i=t=>{const e=new THREE.Vector3;return e.copy(t),this.el.object3D.localToWorld(e),e};let s;s=this.localEl&&this.localEl.object3D?i(t(e(this.localEl.object3D.position),this.data.offset,this.data.snap)):t(this.el.object3D.position,this.data.offset,this.data.snap),console.log("snapPos",s),this.el.object3D.position.copy(s),this.el.object3D.position.y=0}})},657:()=>{const t=[],e=[[-1,-1],[-1,1],[1,-1],[1,1]];e.forEach((e=>{e[0],e[1],t.push({coord:e.join(","),model:"park_base",rotation:0,elevation:0})}));const i={color:{list:{Blue:"#6199D5",Red:"#E54661",Green:"#61D576",Yellow:"#E0D629",Purple:"#CA29E0"},index:0,name:"",hex:""},model:{list:{watertower:{dist:"dist/models/watertower.glb",img:"dist/img/watertower.jpg"},tree_E:{dist:"dist/models/tree_E.glb",img:"dist/img/tree_E.jpg"},road_junction:{dist:"dist/models/road_junction.glb",img:"dist/img/road_junction.jpg"},road_straight:{dist:"dist/models/road_straight.glb",img:"dist/img/road_straight.jpg"},building_F:{dist:"dist/models/building_F.glb",img:"dist/img/building_F.jpg"}},index:0,name:"",img:""},grid:t};function s(t,i){return!(!t&&i)&&-1!=e.findIndex((e=>e[0]==t&&e[1]==i))}function n(t,e,i){if(!e&&i)return;const s=[e,i].join(","),n=t.findIndex((t=>t.coord==s));return-1===n?null:n}function o(t){return Object.keys(t.color.list)[t.color.index]}function r(t){const e=o(t);return t.color.list[e]}function a(t){return Object.keys(t.model.list)[t.model.index]}function l(t){const e=a(t);return t.model.list[e].dist}AFRAME.registerState({initialState:i,handlers:{decreaseColorIndex:function(t){t.color.index-=1,t.color.index<0&&(t.color.index=0)},increaseColorIndex:function(t){t.color.index+=1,t.color.index>=Object.keys(t.color.list).length&&(t.color.index-=1)},decreaseModelIndex:function(t){t.model.index-=1,t.model.index<0&&(t.model.index=0)},increaseModelIndex:function(t){t.model.index+=1,t.model.index>=Object.keys(t.model.list).length&&(t.model.index-=1)},addModel:function(t,e){t.model.list[e.name]={dist:e.dist,img:e.img}},addGridObject:function(t,e){console.log("Adding Grid Object:",e);let{lon:i,lat:o,model:r,rotation:l,elevation:d}=e;if(s(i,o))return void console.log("Cannot place object on city hall");r||(r=a(t)),l||(l=0),d||(d=0),console.log("model",r);const c=n(t.grid,i,o);c?t.grid[c].model===r?this.rotateOrElevateGridObject(t,{keyCell:c,addRotation:90}):(t.grid.__dirty=!0,t.grid[c].model=r,t.grid[c].rotation=0):t.grid.push({coord:[i,o].join(","),model:r,rotation:l,elevation:d}),console.log("Updated Grid State:",t.grid)},rotateOrElevateGridObject:function(t,e){let{lon:i,lat:o,addRotation:r,addElevation:a,keyCell:l}=e;if(!s(i,o)){if(l=l??n(t.grid,i,o),r){t.grid.__dirty=!0;const e=t.grid[l].rotation;t.grid[l].rotation=(e+r)%360}a&&(t.grid[l].elevation+=a)}},clearGridCell:function(t,e){const{lon:i,lat:o,keyCell:r}=e;s(i,o)||(r=r??n(t.grid,i,o),r&&t.grid.splice(r,1))}},computeState:function(t,e){t.color.name=o(t),t.color.hex=r(t),t.model.name=a(t),t.model.img=function(t){const e=a(t);return t.model.list[e].img}(t),t.model.path=l(t)}}),AFRAME.registerComponent("load-catalog",{schema:{source:{type:"selector"}},init:function(){if(this.data.source){this.jsonCatalogData=JSON.parse(this.data.source.data),console.log(this.jsonCatalogData);for(let t=0;t<this.jsonCatalogData.length;t++){const e=this.jsonCatalogData[t];AFRAME.scenes[0].emit("addModel",e)}this.el.catalogIsloaded=!0,this.el.emit("catalogIsLoaded")}}}),AFRAME.registerComponent("set-color-from-state",{dependencies:["material"],init:function(){this.el.setAttribute("material","color",r(AFRAME.scenes[0].systems.state.state))}}),AFRAME.registerComponent("set-model-from-state",{init:function(){this.runOnce=!0},update:function(){this.runOnce&&(this.el.setAttribute("gltf-model","url(./"+l(AFRAME.scenes[0].systems.state.state)+")"),this.el.setAttribute("scale","0.125 0.125 0.125"),this.runOnce=!1)}})},430:()=>{!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("slice9",{schema:{alphaTest:{default:0},bottom:{default:0,min:0},color:{type:"color",default:"#fff"},debug:{default:!1},height:{default:1,min:0},left:{default:0,min:0},opacity:{default:1,min:0,max:1},padding:{default:.1,min:.01},right:{default:0,min:0},side:{default:"front",oneOf:["front","back","double"]},src:{type:"map"},top:{default:0,min:0},transparent:{default:!0},width:{default:1,min:0},usingCustomMaterial:{default:!1},usingAtlas:{default:!1},uvAtlasMin:{type:"vec2"},uvAtlasMax:{type:"vec2"}},init:function(){var t,e,i=this.data;this.textureSrc=null,t=this.geometry=new THREE.PlaneGeometry(i.width,i.height,3,3),i.usingCustomMaterial?this.plane=new THREE.Mesh(t):(e=this.material=new THREE.MeshBasicMaterial({alphaTest:i.alphaTest,color:i.color,opacity:i.opacity,transparent:i.transparent,wireframe:i.debug}),this.plane=new THREE.Mesh(t,e)),this.el.setObject3D("mesh",this.plane)},remove:function(){this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose()},regenerateMesh:function(){var t,e,i,s=this.data,n=this.geometry.attributes.position.array,o=this.geometry.attributes.uv.array;if(!this.material||this.material.map){s.usingCustomMaterial?(t=1,i=1):(t=this.material.map.image.width,i=this.material.map.image.width),p(1,(e={left:s.left/i,right:s.right/i,top:s.top/t,bottom:s.bottom/t}).left,1),p(2,e.right,1),p(4,0,e.bottom),p(5,e.left,e.bottom),p(6,e.right,e.bottom),p(7,1,e.bottom),p(8,0,e.top),p(9,e.left,e.top),p(10,e.right,e.top),p(11,1,e.top),p(13,e.left,0),p(14,e.right,0),s.usingAtlas&&(p(0,0,1),p(3,1,1),p(12,0,0),p(15,1,0));var r=s.width/2,a=s.height/2,l=-r+s.padding,d=r-s.padding,c=a-s.padding,h=-a+s.padding;u(0,-r,a),u(1,l,a),u(2,d,a),u(3,r,a),u(4,-r,c),u(5,l,c),u(6,d,c),u(7,r,c),u(8,-r,h),u(9,l,h),u(10,d,h),u(11,r,h),u(13,l,-a),u(14,d,-a),u(12,-r,-a),u(15,r,-a),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0}function u(t,e,i){n[3*t]=e,n[3*t+1]=i}function p(t,e,i){s.usingAtlas&&(e=s.uvAtlasMin.x+e*(s.uvAtlasMax.x-s.uvAtlasMin.x),i=s.uvAtlasMin.y+i*(s.uvAtlasMax.y-s.uvAtlasMin.y)),o[2*t]=e,o[2*t+1]=i}},update:function(t){var e,i=this.data;e=AFRAME.utils.diff(i,t),i.usingCustomMaterial||(this.material.alphaTest=i.alphaTest,this.material.color.setStyle(i.color),this.material.opacity=i.opacity,this.material.transparent=i.transparent,this.material.wireframe=i.debug,this.material.side=function(t){switch(t){case"back":return THREE.BackSide;case"double":return THREE.DoubleSide;default:return THREE.FrontSide}}(i.side),"src"in e&&this.updateMap()),("width"in e||"height"in e)&&(this.geometry=new THREE.PlaneGeometry(i.width,i.height,3,3),this.plane.geometry=this.geometry),("width"in e||"height"in e||"padding"in e||"left"in e||"top"in e||"bottom"in e||"right"in e)&&this.regenerateMesh()},updateMap:function(){var t=this.data.src;if(t){if(t===this.textureSrc)return;return this.textureSrc=t,void this.el.sceneEl.systems.material.loadTexture(t,{src:t},e.bind(this))}function e(t){this.material.map=t,this.material.needsUpdate=!0,this.regenerateMesh()}this.material.map&&e(null)}})}])}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,i),o.exports}return i(699),i(858),i(174),i(631),i(699),i(1),i(430),i(613),i(216),i(133),i(490),i(657),i(58),i(318),i(684),{}})()));